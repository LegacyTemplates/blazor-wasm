@page "/admin"
@inherits AppAuthComponentBase
@inject ServiceStackStateProvider AuthStateProvider;
@inject NavigationManager NavigationManager;

<NavAdmin />
@if (!HasInit) return;

<div class="admin-page">
@if (User.HasRole(AppRoles.Admin))
{
    <h2>
        <span class="svg svg-admin-home svg-2.5x align-bottom"></span>
        Admin Home
    </h2>

    <ErrorSummary Status=@appMetadataResult.ErrorStatus />
}
else
{
    <h1>Sorry</h1>

    <p class="mt-4 text-danger">
        <span class="oi oi-shield me-2"></span>
        This area is only accessible to users with the <b>Admin</b> role
    </p>    

    <div>
        <p>
            Please 
            <a href="#" @onclick="SignInAsAnotherUser" @onclick:preventDefault>Login</a>
            as a user with the <b>Admin</b> role.
        </p>
    </div>
}
</div>

@code {

    async Task SignInAsAnotherUser()
    {
        await AuthStateProvider.LogoutAsync();
        NavigationManager.NavigateTo($"/signin?return={NavigationManager.ToBaseRelativePath(NavigationManager.Uri)}", true);
    }

    ApiResult<AppMetadata> appMetadataResult = new();

    protected override async Task OnInitializedAsync()
    {
        if (!appMetadataResult.IsSuccess)
            appMetadataResult = await this.ApiAppMetadataAsync(); // pre-load App Metadata
    }
}
